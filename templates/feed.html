{% extends "base.html" %}
{% block title %}Feed{% endblock %}
{% block content %}
<div class="card">
    <h2>What's on your mind?</h2>
    <form method="POST" action="{{ url_for('create_post') }}">
        <textarea name="content" placeholder="Share something..." required></textarea>
        <button class="btn">Post</button>
    </form>
</div>

{% for post in posts %}
<div class="card post">
    <div class="post-author"><a href="{{ url_for('profile', username=post.author.username) }}" style="color: #1877f2; text-decoration: none;">{{ post.author.username }}</a></div>
    <div class="post-time">{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
    <div class="post-content">{{ post.content }}</div>

    <div class="post-actions">
       <div style="display: flex; gap: 10px; align-items: center;">
           <form method="POST" action="{{ url_for('like_post', post_id=post.id) }}" style="display: flex; gap: 5px;">
               <button class="btn btn-secondary" name="reaction" value="love" style="padding: 5px 10px;">â¤ï¸ Love</button>
               <button class="btn btn-secondary" name="reaction" value="haha" style="padding: 5px 10px;">ğŸ˜‚ Haha</button>
               <button class="btn btn-secondary" name="reaction" value="wow" style="padding: 5px 10px;">ğŸ˜® Wow</button>
               <button class="btn btn-secondary" name="reaction" value="sad" style="padding: 5px 10px;">ğŸ˜¢ Sad</button>
               <button class="btn btn-secondary" name="reaction" value="angry" style="padding: 5px 10px;">ğŸ˜¡ Angry</button>
           </form>
           <span style="color: #65676b;">{{ post.likes|length }}</span>
       </div>
       {% if post.user_id == user.id %}
       <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display: inline; margin-top: 10px;">
           <button class="btn btn-secondary" style="padding: 5px 10px; background: #ffdbdb; color: #d32f2f;">Delete</button>
       </form>
       {% endif %}
   </div>
        {% if post.user_id == user.id %}
        <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display: inline;">
            <button class="btn btn-secondary" style="padding: 5px 10px; background: #ffdbdb; color: #d32f2f;">Delete</button>
        </form>
        {% endif %}
    </div>

    {% if post.comments %}
    <div style="margin-top: 15px;">
        {% for comment in post.comments %}
        <div class="comment">
            <span class="comment-author">{{ comment.user.username }}</span>: {{ comment.content }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}" style="margin-top: 10px;">
        <input type="text" name="content" placeholder="Add a comment..." style="margin: 0;">
        <button class="btn" style="width: auto; margin-top: 5px; padding: 5px 15px;">Comment</button>
    </form>
</div>
{% endfor %}
{% endblock %}